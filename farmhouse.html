<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Farmhouse Management</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #10B981;
            --primary-dark: #059669;
            --secondary: #F59E0B;
            --accent: #3B82F6;
            --danger: #EF4444;
            --success: #10B981;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        }
        
        .glass-panel {
            background: rgba(255, 255, 255, 0.92);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.2);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .glass-panel:hover {
            box-shadow: 0 12px 40px rgba(31, 38, 135, 0.3);
            transform: translateY(-2px);
        }
        
        .btn-live {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            border: none;
            padding: 12px 28px;
            border-radius: 12px;
            font-weight: 600;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }
        
        .btn-live:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(16, 185, 129, 0.4);
        }
        
        .btn-live:active {
            transform: translateY(0);
        }
        
        .live-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            width: 20px;
            height: 20px;
            background: var(--danger);
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); }
            70% { transform: scale(1); box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); }
            100% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
        }
        
        .farmhouse-card {
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            position: relative;
        }
        
        .farmhouse-card:hover {
            transform: translateY(-10px) scale(1.02);
        }
        
        .card-image {
            height: 200px;
            object-fit: cover;
            border-radius: 15px 15px 0 0;
            transition: transform 0.5s ease;
        }
        
        .farmhouse-card:hover .card-image {
            transform: scale(1.1);
        }
        
        .price-tag {
            position: absolute;
            top: 15px;
            right: 15px;
            background: linear-gradient(135deg, var(--secondary), #FBBF24);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 700;
            box-shadow: 0 4px 15px rgba(245, 158, 11, 0.3);
        }
        
        .availability-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 6px;
            animation: blink 3s infinite;
        }
        
        .available { background: var(--success); }
        .booked { background: var(--danger); }
        .soon { background: var(--accent); }
        
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .stat-card {
            padding: 25px;
            border-radius: 16px;
            background: linear-gradient(135deg, rgba(255,255,255,0.9), rgba(255,255,255,0.8));
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.3);
            transition: all 0.3s;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
        }
        
        .counter {
            font-size: 3rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            transition: all 0.5s;
        }
        
        .live-update {
            animation: highlight 1s ease;
        }
        
        @keyframes highlight {
            0% { background: rgba(16, 185, 129, 0.2); }
            100% { background: transparent; }
        }
        
        .amenity-tag {
            display: inline-block;
            background: rgba(16, 185, 129, 0.1);
            border: 2px solid var(--primary);
            padding: 6px 12px;
            margin: 4px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
            transition: all 0.3s;
        }
        
        .amenity-tag:hover {
            background: var(--primary);
            color: white;
            transform: translateY(-2px);
        }
        
        .form-control-live {
            border: 2px solid #E5E7EB;
            border-radius: 12px;
            padding: 14px;
            transition: all 0.3s;
        }
        
        .form-control-live:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
            transform: translateY(-2px);
        }
        
        .modal-content {
            border-radius: 20px;
            border: none;
            overflow: hidden;
        }
        
        .tab-content {
            padding: 25px;
        }
        
        .nav-tabs .nav-link {
            border: none;
            padding: 15px 25px;
            color: #6B7280;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .nav-tabs .nav-link.active {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border-radius: 12px 12px 0 0;
        }
        
        .action-btn {
            width: 40px;
            height: 40px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .action-btn:hover {
            transform: translateY(-3px) scale(1.1);
        }
        
        .edit-btn { background: rgba(59, 130, 246, 0.1); color: var(--accent); }
        .delete-btn { background: rgba(239, 68, 68, 0.1); color: var(--danger); }
        .date-btn { background: rgba(245, 158, 11, 0.1); color: var(--secondary); }
        .view-btn { background: rgba(16, 185, 129, 0.1); color: var(--success); }
        
        .calendar-day {
            padding: 12px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            font-weight: 500;
        }
        
        .calendar-day:hover {
            transform: scale(1.05);
        }
        
        .available-date {
            background: rgba(16, 185, 129, 0.1);
            border: 2px solid var(--success);
            color: var(--success);
        }
        
        .booked-date {
            background: rgba(239, 68, 68, 0.1);
            border: 2px solid var(--danger);
            color: var(--danger);
            cursor: not-allowed;
        }
        
        .selected-date {
            background: var(--primary);
            color: white;
            border: 2px solid var(--primary);
        }
        
        .image-preview {
            width: 100px;
            height: 80px;
            object-fit: cover;
            border-radius: 10px;
            margin: 5px;
            border: 2px solid transparent;
            transition: all 0.3s;
        }
        
        .image-preview:hover {
            transform: scale(1.1);
            border-color: var(--primary);
        }
        
        .toast-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            min-width: 300px;
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            transform: translateX(400px);
            transition: transform 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            z-index: 9999;
        }
        
        .toast-show {
            transform: translateX(0);
        }
        
        .search-box {
            position: relative;
        }
        
        .search-box input {
            padding-left: 45px;
        }
        
        .search-box i {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #9CA3AF;
        }
        
        @media (max-width: 768px) {
            .counter {
                font-size: 2rem;
            }
            
            .farmhouse-card:hover {
                transform: translateY(-5px) scale(1.01);
            }
        }
    </style>
</head>
<body>
    <!-- Live Notification -->
    <div id="liveNotification" class="toast-notification">
        <div class="d-flex align-items-center">
            <div class="me-3">
                <i class="fas fa-sync-alt fa-spin text-primary"></i>
            </div>
            <div>
                <h6 class="mb-0" id="notificationTitle"></h6>
                <small class="text-muted" id="notificationMessage"></small>
            </div>
        </div>
    </div>

    <!-- Main Container -->
    <div class="container-fluid py-4">
        <div class="row">
            <!-- Header -->
            <div class="col-12 mb-4">
                <div class="glass-panel p-4">
                    <div class="row align-items-center">
                        <div class="col-md-6">
                            <h1 class="fw-bold text-dark mb-2">
                                <i class="fas fa-home text-primary me-2"></i>
                                Live Farmhouse Manager
                            </h1>
                            <p class="text-muted mb-0">Real-time updates • Instant changes • No reload needed</p>
                        </div>
                        <div class="col-md-6 text-end">
                            <button class="btn btn-live position-relative" onclick="showAddForm()">
                                <i class="fas fa-plus me-2"></i>Add Farmhouse
                                <span class="live-badge"></span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Live Stats -->
            <div class="col-xl-3 col-md-6 mb-4">
                <div class="stat-card" id="statFarmhouses">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="text-muted">Total Farmhouses</h6>
                            <div class="counter" id="counterFarmhouses">0</div>
                        </div>
                        <i class="fas fa-home fa-3x text-primary opacity-25"></i>
                    </div>
                </div>
            </div>
            
            <div class="col-xl-3 col-md-6 mb-4">
                <div class="stat-card" id="statAvailable">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="text-muted">Available Now</h6>
                            <div class="counter" id="counterAvailable">0</div>
                        </div>
                        <i class="fas fa-calendar-check fa-3x text-success opacity-25"></i>
                    </div>
                </div>
            </div>
            
            <div class="col-xl-3 col-md-6 mb-4">
                <div class="stat-card" id="statRevenue">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="text-muted">Total Revenue</h6>
                            <div class="counter" id="counterRevenue">$0</div>
                        </div>
                        <i class="fas fa-dollar-sign fa-3x text-warning opacity-25"></i>
                    </div>
                </div>
            </div>
            
            <div class="col-xl-3 col-md-6 mb-4">
                <div class="stat-card" id="statBookings">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="text-muted">Active Bookings</h6>
                            <div class="counter" id="counterBookings">0</div>
                        </div>
                        <i class="fas fa-bookmark fa-3x text-accent opacity-25"></i>
                    </div>
                </div>
            </div>

            <!-- Search & Filter -->
            <div class="col-12 mb-4">
                <div class="glass-panel p-4">
                    <div class="row g-3">
                        <div class="col-md-6 search-box">
                            <i class="fas fa-search"></i>
                            <input type="text" class="form-control form-control-live" 
                                   placeholder="Search farmhouses..." 
                                   oninput="liveSearch(this.value)">
                        </div>
                        <div class="col-md-3">
                            <select class="form-select form-control-live" onchange="filterByStatus(this.value)">
                                <option value="">All Status</option>
                                <option value="available">Available</option>
                                <option value="booked">Booked</option>
                                <option value="soon">Coming Soon</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <select class="form-select form-control-live" onchange="filterByPrice(this.value)">
                                <option value="">All Prices</option>
                                <option value="low">Under $150</option>
                                <option value="medium">$150 - $300</option>
                                <option value="high">Over $300</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Farmhouses Grid -->
            <div class="col-12">
                <div class="row" id="farmhousesContainer">
                    <!-- Farmhouses will be loaded dynamically -->
                </div>
            </div>

            <!-- Empty State -->
            <div class="col-12" id="emptyState" style="display: none;">
                <div class="text-center py-5">
                    <i class="fas fa-home fa-4x text-muted mb-4"></i>
                    <h4 class="text-muted mb-3">No Farmhouses Found</h4>
                    <p class="text-muted mb-4">Add your first farmhouse to get started</p>
                    <button class="btn btn-live" onclick="showAddForm()">
                        <i class="fas fa-plus me-2"></i>Add First Farmhouse
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add/Edit Modal -->
    <div class="modal fade" id="farmhouseModal" tabindex="-1" data-bs-backdrop="static">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-gradient-primary text-white">
                    <h5 class="modal-title" id="modalTitle">Add New Farmhouse</h5>
                    <button type="button" class="btn-close btn-close-white" onclick="closeModal()"></button>
                </div>
                <div class="modal-body">
                    <form id="farmhouseForm" onsubmit="return saveFarmhouse(event)">
                        <input type="hidden" id="farmhouseId">
                        
                        <!-- Tabs -->
                        <ul class="nav nav-tabs mb-3" id="formTabs">
                            <li class="nav-item">
                                <a class="nav-link active" onclick="switchTab('basic')">
                                    <i class="fas fa-info-circle me-2"></i>Basic Info
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" onclick="switchTab('pricing')">
                                    <i class="fas fa-tag me-2"></i>Pricing & Dates
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" onclick="switchTab('photos')">
                                    <i class="fas fa-images me-2"></i>Photos
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" onclick="switchTab('amenities')">
                                    <i class="fas fa-star me-2"></i>Amenities
                                </a>
                            </li>
                        </ul>

                        <!-- Tab Content -->
                        <div id="tabContent">
                            <!-- Basic Info -->
                            <div class="tab-pane active" id="basicTab">
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <label class="form-label fw-bold">Farmhouse Name</label>
                                        <input type="text" class="form-control form-control-live" 
                                               id="name" required oninput="validateField(this)">
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label fw-bold">Location</label>
                                        <input type="text" class="form-control form-control-live" 
                                               id="location" required oninput="validateField(this)">
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-label fw-bold">Bedrooms</label>
                                        <input type="number" class="form-control form-control-live" 
                                               id="bedrooms" min="1" required oninput="validateField(this)">
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-label fw-bold">Bathrooms</label>
                                        <input type="number" class="form-control form-control-live" 
                                               id="bathrooms" min="1" required oninput="validateField(this)">
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-label fw-bold">Max Guests</label>
                                        <input type="number" class="form-control form-control-live" 
                                               id="maxGuests" min="1" required oninput="validateField(this)">
                                    </div>
                                    <div class="col-12">
                                        <label class="form-label fw-bold">Description</label>
                                        <textarea class="form-control form-control-live" 
                                                  id="description" rows="4" 
                                                  oninput="validateField(this)"></textarea>
                                    </div>
                                </div>
                            </div>

                            <!-- Pricing & Dates -->
                            <div class="tab-pane" id="pricingTab" style="display: none;">
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <label class="form-label fw-bold">Base Price/Night ($)</label>
                                        <input type="number" class="form-control form-control-live" 
                                               id="price" min="0" step="0.01" required 
                                               oninput="updatePricePreview()">
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label fw-bold">Weekend Price ($)</label>
                                        <input type="number" class="form-control form-control-live" 
                                               id="weekendPrice" min="0" step="0.01"
                                               oninput="updatePricePreview()">
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label fw-bold">Available From</label>
                                        <input type="date" class="form-control form-control-live" 
                                               id="availableFrom" required onchange="updateAvailability()">
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label fw-bold">Available To</label>
                                        <input type="date" class="form-control form-control-live" 
                                               id="availableTo" required onchange="updateAvailability()">
                                    </div>
                                    <div class="col-12">
                                        <div class="card bg-light">
                                            <div class="card-body">
                                                <h6 class="card-title">Price Preview</h6>
                                                <div class="d-flex justify-content-between mb-2">
                                                    <span>Base Price:</span>
                                                    <strong id="previewBasePrice">$0</strong>
                                                </div>
                                                <div class="d-flex justify-content-between mb-2">
                                                    <span>Weekend Price:</span>
                                                    <strong id="previewWeekendPrice">$0</strong>
                                                </div>
                                                <div class="d-flex justify-content-between mb-2">
                                                    <span>Availability:</span>
                                                    <span id="previewAvailability">Not Set</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Photos -->
                            <div class="tab-pane" id="photosTab" style="display: none;">
                                <div class="mb-3">
                                    <label class="form-label fw-bold">Add Photo URLs</label>
                                    <textarea class="form-control form-control-live" 
                                              id="photoUrls" rows="3" 
                                              placeholder="Enter one image URL per line"
                                              oninput="updatePhotoPreview()"></textarea>
                                    <small class="text-muted">Add multiple images for slideshow</small>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label fw-bold">Or Upload Images</label>
                                    <input type="file" class="form-control form-control-live" 
                                           id="imageUpload" multiple accept="image/*"
                                           onchange="handleImageUpload()">
                                </div>
                                <div class="photo-preview" id="photoPreview">
                                    <!-- Image previews will be shown here -->
                                </div>
                            </div>

                            <!-- Amenities -->
                            <div class="tab-pane" id="amenitiesTab" style="display: none;">
                                <div class="row">
                                    <div class="col-md-4">
                                        <div class="form-check mb-3">
                                            <input class="form-check-input" type="checkbox" value="WiFi" id="wifi">
                                            <label class="form-check-label" for="wifi">High-Speed WiFi</label>
                                        </div>
                                        <div class="form-check mb-3">
                                            <input class="form-check-input" type="checkbox" value="Pool" id="pool">
                                            <label class="form-check-label" for="pool">Swimming Pool</label>
                                        </div>
                                        <div class="form-check mb-3">
                                            <input class="form-check-input" type="checkbox" value="Kitchen" id="kitchen">
                                            <label class="form-check-label" for="kitchen">Full Kitchen</label>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-check mb-3">
                                            <input class="form-check-input" type="checkbox" value="Parking" id="parking">
                                            <label class="form-check-label" for="parking">Free Parking</label>
                                        </div>
                                        <div class="form-check mb-3">
                                            <input class="form-check-input" type="checkbox" value="AC" id="ac">
                                            <label class="form-check-label" for="ac">Air Conditioning</label>
                                        </div>
                                        <div class="form-check mb-3">
                                            <input class="form-check-input" type="checkbox" value="Garden" id="garden">
                                            <label class="form-check-label" for="garden">Garden</label>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-check mb-3">
                                            <input class="form-check-input" type="checkbox" value="BBQ" id="bbq">
                                            <label class="form-check-label" for="bbq">BBQ Area</label>
                                        </div>
                                        <div class="form-check mb-3">
                                            <input class="form-check-input" type="checkbox" value="Pet Friendly" id="pet">
                                            <label class="form-check-label" for="pet">Pet Friendly</label>
                                        </div>
                                        <div class="form-check mb-3">
                                            <input class="form-check-input" type="checkbox" value="Fireplace" id="fireplace">
                                            <label class="form-check-label" for="fireplace">Fireplace</label>
                                        </div>
                                    </div>
                                </div>
                                <div class="amenities-preview mt-4" id="amenitiesPreview">
                                    <!-- Selected amenities will be shown here -->
                                </div>
                            </div>
                        </div>

                        <div class="d-flex justify-content-between mt-4 pt-3 border-top">
                            <button type="button" class="btn btn-outline-secondary" onclick="closeModal()">
                                Cancel
                            </button>
                            <button type="submit" class="btn btn-live">
                                <i class="fas fa-save me-2"></i>Save Farmhouse
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Manage Dates Modal -->
    <div class="modal fade" id="datesModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-gradient-warning text-white">
                    <h5 class="modal-title">Manage Availability</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="currentFarmhouseId">
                    <h6 id="farmhouseNameDates" class="mb-3"></h6>
                    
                    <!-- Calendar -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <div id="availabilityCalendar" class="p-3 bg-light rounded">
                                <!-- Calendar will be generated here -->
                            </div>
                        </div>
                    </div>
                    
                    <!-- Quick Actions -->
                    <div class="row g-2 mb-4">
                        <div class="col-md-6">
                            <button class="btn btn-danger w-100" onclick="blockSelectedDates()">
                                <i class="fas fa-ban me-2"></i>Block Selected Dates
                            </button>
                        </div>
                        <div class="col-md-6">
                            <button class="btn btn-success w-100" onclick="unblockSelectedDates()">
                                <i class="fas fa-check me-2"></i>Unblock Selected
                            </button>
                        </div>
                    </div>
                    
                    <!-- Blocked Dates List -->
                    <div class="blocked-dates-list" id="blockedDatesList"></div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // ==================== GLOBAL STATE ====================
        let farmhouses = JSON.parse(localStorage.getItem('farmhouses')) || [];
        let bookings = JSON.parse(localStorage.getItem('bookings')) || [];
        let currentFilter = '';
        let currentSearch = '';
        let selectedDates = new Set();

        // ==================== INITIALIZATION ====================
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            startLiveUpdates();
            loadSampleDataIfEmpty();
        });

        function initializeApp() {
            updateAllCounters();
            renderFarmhouses();
            setupEventListeners();
        }

        function setupEventListeners() {
            // Real-time validation
            document.querySelectorAll('input, textarea').forEach(element => {
                element.addEventListener('input', function() {
                    validateField(this);
                });
            });

            // Auto-save listener
            let autoSaveTimer;
            document.getElementById('farmhouseForm')?.addEventListener('input', function() {
                clearTimeout(autoSaveTimer);
                autoSaveTimer = setTimeout(autoSaveDraft, 2000);
            });
        }

        // ==================== REAL-TIME UPDATES ====================
        function startLiveUpdates() {
            // Simulate live updates every 30 seconds
            setInterval(updateAllCounters, 30000);
            setInterval(checkForChanges, 5000);
        }

        function checkForChanges() {
            // Check if data changed in other tabs
            const savedData = localStorage.getItem('farmhouses');
            if (savedData && JSON.stringify(farmhouses) !== savedData) {
                farmhouses = JSON.parse(savedData);
                updateAllCounters();
                renderFarmhouses();
                showNotification('Data Updated', 'Farmhouse list has been updated');
            }
        }

        // ==================== FARMHOUSE MANAGEMENT ====================
        function showAddForm() {
            resetForm();
            document.getElementById('modalTitle').textContent = 'Add New Farmhouse';
            document.getElementById('farmhouseId').value = '';
            
            // Set default dates
            const today = new Date();
            const nextMonth = new Date(today);
            nextMonth.setMonth(today.getMonth() + 1);
            
            document.getElementById('availableFrom').value = today.toISOString().split('T')[0];
            document.getElementById('availableTo').value = nextMonth.toISOString().split('T')[0];
            
            switchTab('basic');
            updatePricePreview();
            showModal();
        }

        function editFarmhouse(id) {
            const farmhouse = farmhouses.find(f => f.id === id);
            if (!farmhouse) return;

            document.getElementById('modalTitle').textContent = 'Edit Farmhouse';
            document.getElementById('farmhouseId').value = farmhouse.id;
            
            // Fill form
            document.getElementById('name').value = farmhouse.name;
            document.getElementById('location').value = farmhouse.location;
            document.getElementById('bedrooms').value = farmhouse.bedrooms;
            document.getElementById('bathrooms').value = farmhouse.bathrooms;
            document.getElementById('maxGuests').value = farmhouse.maxGuests;
            document.getElementById('description').value = farmhouse.description;
            document.getElementById('price').value = farmhouse.price;
            document.getElementById('weekendPrice').value = farmhouse.weekendPrice || '';
            document.getElementById('availableFrom').value = farmhouse.availableFrom;
            document.getElementById('availableTo').value = farmhouse.availableTo;
            document.getElementById('photoUrls').value = farmhouse.photoUrls?.join('\n') || '';
            
            // Set amenities checkboxes
            ['wifi', 'pool', 'kitchen', 'parking', 'ac', 'garden', 'bbq', 'pet', 'fireplace'].forEach(amenity => {
                const checkbox = document.getElementById(amenity);
                if (checkbox) {
                    const amenityName = checkbox.value;
                    checkbox.checked = farmhouse.amenities?.includes(amenityName) || false;
                }
            });
            
            switchTab('basic');
            updatePricePreview();
            updatePhotoPreview();
            updateAmenitiesPreview();
            showModal();
        }

        function saveFarmhouse(event) {
            event.preventDefault();
            
            const formData = {
                id: document.getElementById('farmhouseId').value || Date.now(),
                name: document.getElementById('name').value,
                location: document.getElementById('location').value,
                bedrooms: parseInt(document.getElementById('bedrooms').value),
                bathrooms: parseInt(document.getElementById('bathrooms').value),
                maxGuests: parseInt(document.getElementById('maxGuests').value),
                description: document.getElementById('description').value,
                price: parseFloat(document.getElementById('price').value),
                weekendPrice: document.getElementById('weekendPrice').value ? 
                    parseFloat(document.getElementById('weekendPrice').value) : null,
                availableFrom: document.getElementById('availableFrom').value,
                availableTo: document.getElementById('availableTo').value,
                photoUrls: document.getElementById('photoUrls').value ?
                    document.getElementById('photoUrls').value.split('\n').map(url => url.trim()).filter(url => url) : [],
                amenities: Array.from(document.querySelectorAll('input[type="checkbox"]:checked'))
                    .map(cb => cb.value),
                createdAt: new Date().toISOString(),
                lastUpdated: new Date().toISOString(),
                status: 'available',
                blockedDates: []
            };

            // Validation
            if (!formData.name || !formData.location || !formData.price) {
                showNotification('Error', 'Please fill all required fields', 'error');
                return false;
            }

            // Save to array
            const existingIndex = farmhouses.findIndex(f => f.id == formData.id);
            if (existingIndex >= 0) {
                farmhouses[existingIndex] = formData;
                showNotification('Updated', 'Farmhouse updated successfully');
            } else {
                farmhouses.push(formData);
                showNotification('Added', 'New farmhouse added successfully');
            }

            // Save to storage
            localStorage.setItem('farmhouses', JSON.stringify(farmhouses));
            
            // Update UI
            updateAllCounters();
            renderFarmhouses();
            closeModal();
            
            return false;
        }

        function deleteFarmhouse(id) {
            if (confirm('Are you sure you want to delete this farmhouse?')) {
                farmhouses = farmhouses.filter(f => f.id != id);
                localStorage.setItem('farmhouses', JSON.stringify(farmhouses));
                
                updateAllCounters();
                renderFarmhouses();
                showNotification('Deleted', 'Farmhouse removed successfully', 'warning');
            }
        }

        function viewFarmhouse(id) {
            const farmhouse = farmhouses.find(f => f.id === id);
            if (farmhouse) {
                alert(`Viewing: ${farmhouse.name}\nLocation: ${farmhouse.location}\nPrice: $${farmhouse.price}/night`);
            }
        }

        function manageDates(id, name) {
            const farmhouse = farmhouses.find(f => f.id === id);
            if (!farmhouse) return;

            document.getElementById('currentFarmhouseId').value = id;
            document.getElementById('farmhouseNameDates').textContent = name;
            selectedDates.clear();
            
            // Generate calendar
            generateCalendar(id);
            
            // Show blocked dates
            updateBlockedDatesList(id);
            
            const datesModal = new bootstrap.Modal(document.getElementById('datesModal'));
            datesModal.show();
        }

        // ==================== RENDERING ====================
        function renderFarmhouses() {
            const container = document.getElementById('farmhousesContainer');
            const emptyState = document.getElementById('emptyState');
            
            // Filter farmhouses
            let filtered = farmhouses;
            
            if (currentSearch) {
                const searchLower = currentSearch.toLowerCase();
                filtered = filtered.filter(f => 
                    f.name.toLowerCase().includes(searchLower) ||
                    f.location.toLowerCase().includes(searchLower) ||
                    f.description.toLowerCase().includes(searchLower)
                );
            }
            
            if (currentFilter) {
                filtered = filtered.filter(f => getStatus(f) === currentFilter);
            }

            // Render
            if (filtered.length === 0) {
                container.innerHTML = '';
                emptyState.style.display = 'block';
                return;
            }

            emptyState.style.display = 'none';
            container.innerHTML = filtered.map(farmhouse => createFarmhouseCard(farmhouse)).join('');
            
            // Add live update animation
            container.classList.add('live-update');
            setTimeout(() => container.classList.remove('live-update'), 1000);
        }

        function createFarmhouseCard(farmhouse) {
            const status = getStatus(farmhouse);
            const statusClass = status === 'available' ? 'available' : 
                               status === 'booked' ? 'booked' : 'soon';
            const statusText = status === 'available' ? 'Available' : 
                              status === 'booked' ? 'Booked' : 'Coming Soon';
            
            const mainImage = farmhouse.photoUrls && farmhouse.photoUrls.length > 0 ? 
                farmhouse.photoUrls[0] : 'https://images.unsplash.com/photo-1568605114967-8130f3a36994?w=800&auto=format&fit=crop';
            
            return `
                <div class="col-xl-4 col-md-6 mb-4">
                    <div class="farmhouse-card glass-panel h-100">
                        <div class="position-relative overflow-hidden">
                            <img src="${mainImage}" class="card-image w-100" alt="${farmhouse.name}">
                            <div class="price-tag">$${farmhouse.price}/night</div>
                            <div class="position-absolute bottom-0 start-0 m-3">
                                <span class="availability-dot ${statusClass}"></span>
                                <span class="text-white fw-bold">${statusText}</span>
                            </div>
                        </div>
                        <div class="p-4">
                            <h5 class="fw-bold mb-2">${farmhouse.name}</h5>
                            <p class="text-muted mb-3">
                                <i class="fas fa-map-marker-alt text-danger me-1"></i>
                                ${farmhouse.location}
                            </p>
                            <div class="d-flex justify-content-between text-muted mb-3">
                                <small><i class="fas fa-bed me-1"></i>${farmhouse.bedrooms} beds</small>
                                <small><i class="fas fa-bath me-1"></i>${farmhouse.bathrooms} baths</small>
                                <small><i class="fas fa-users me-1"></i>${farmhouse.maxGuests} guests</small>
                            </div>
                            <p class="small text-muted mb-3">${farmhouse.description.substring(0, 100)}...</p>
                            
                            <div class="amenities mb-3">
                                ${farmhouse.amenities.slice(0, 3).map(amenity => 
                                    `<span class="amenity-tag">${amenity}</span>`
                                ).join('')}
                                ${farmhouse.amenities.length > 3 ? 
                                    `<span class="amenity-tag">+${farmhouse.amenities.length - 3} more</span>` : ''
                                }
                            </div>
                            
                            <div class="d-flex gap-2">
                                <div class="action-btn view-btn" onclick="viewFarmhouse(${farmhouse.id})" 
                                     title="View Details">
                                    <i class="fas fa-eye"></i>
                                </div>
                                <div class="action-btn edit-btn" onclick="editFarmhouse(${farmhouse.id})" 
                                     title="Edit Farmhouse">
                                    <i class="fas fa-edit"></i>
                                </div>
                                <div class="action-btn date-btn" 
                                     onclick="manageDates(${farmhouse.id}, '${farmhouse.name}')" 
                                     title="Manage Dates">
                                    <i class="fas fa-calendar"></i>
                                </div>
                                <div class="action-btn delete-btn" onclick="deleteFarmhouse(${farmhouse.id})" 
                                     title="Delete Farmhouse">
                                    <i class="fas fa-trash"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // ==================== LIVE UPDATES ====================
        function updateAllCounters() {
            // Total farmhouses
            document.getElementById('counterFarmhouses').textContent = farmhouses.length;
            document.getElementById('statFarmhouses').classList.add('live-update');
            
            // Available now
            const availableCount = farmhouses.filter(f => getStatus(f) === 'available').length;
            document.getElementById('counterAvailable').textContent = availableCount;
            document.getElementById('statAvailable').classList.add('live-update');
            
            // Total revenue
            const revenue = bookings.reduce((sum, b) => sum + b.totalAmount, 0);
            document.getElementById('counterRevenue').textContent = `$${revenue}`;
            document.getElementById('statRevenue').classList.add('live-update');
            
            // Active bookings
            const activeBookings = bookings.filter(b => b.status === 'active').length;
            document.getElementById('counterBookings').textContent = activeBookings;
            document.getElementById('statBookings').classList.add('live-update');
            
            // Remove animation classes
            setTimeout(() => {
                ['statFarmhouses', 'statAvailable', 'statRevenue', 'statBookings'].forEach(id => {
                    document.getElementById(id)?.classList.remove('live-update');
                });
            }, 1000);
        }

        // ==================== FILTERING & SEARCH ====================
        function liveSearch(query) {
            currentSearch = query.toLowerCase();
            renderFarmhouses();
        }

        function filterByStatus(status) {
            currentFilter = status;
            renderFarmhouses();
        }

        function filterByPrice(range) {
            // This would filter by price range
            renderFarmhouses();
        }

        // ==================== UTILITY FUNCTIONS ====================
        function getStatus(farmhouse) {
            const today = new Date();
            const availableFrom = new Date(farmhouse.availableFrom);
            const availableTo = new Date(farmhouse.availableTo);
            
            if (today < availableFrom) return 'soon';
            if (today > availableTo) return 'booked';
            
            // Check if any bookings exist for today
            const hasBooking = bookings.some(b => 
                b.farmhouseId === farmhouse.id && 
                new Date(b.checkIn) <= today && 
                new Date(b.checkOut) >= today
            );
            
            return hasBooking ? 'booked' : 'available';
        }

        function showNotification(title, message, type = 'success') {
            const notification = document.getElementById('liveNotification');
            const titleEl = document.getElementById('notificationTitle');
            const messageEl = document.getElementById('notificationMessage');
            
            titleEl.textContent = title;
            messageEl.textContent = message;
            
            // Set color based on type
            notification.style.borderLeft = `4px solid ${
                type === 'success' ? '#10B981' : 
                type === 'error' ? '#EF4444' : '#3B82F6'
            }`;
            
            notification.classList.add('toast-show');
            
            setTimeout(() => {
                notification.classList.remove('toast-show');
            }, 3000);
        }

        function showModal() {
            const modal = new bootstrap.Modal(document.getElementById('farmhouseModal'));
            modal.show();
        }

        function closeModal() {
            const modal = bootstrap.Modal.getInstance(document.getElementById('farmhouseModal'));
            modal?.hide();
        }

        function switchTab(tabName) {
            // Hide all tabs
            ['basic', 'pricing', 'photos', 'amenities'].forEach(tab => {
                document.getElementById(tab + 'Tab').style.display = 'none';
                document.querySelector(`a[onclick="switchTab('${tab}')"]`).classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabName + 'Tab').style.display = 'block';
            document.querySelector(`a[onclick="switchTab('${tabName}')"]`).classList.add('active');
        }

        function updatePricePreview() {
            const price = document.getElementById('price').value || 0;
            const weekendPrice = document.getElementById('weekendPrice').value || price;
            
            document.getElementById('previewBasePrice').textContent = `$${price}`;
            document.getElementById('previewWeekendPrice').textContent = `$${weekendPrice}`;
        }

        function updateAvailability() {
            const from = document.getElementById('availableFrom').value;
            const to = document.getElementById('availableTo').value;
            
            if (from && to) {
                document.getElementById('previewAvailability').textContent = 
                    `${from} to ${to}`;
            }
        }

        function updatePhotoPreview() {
            const urls = document.getElementById('photoUrls').value.split('\n');
            const preview = document.getElementById('photoPreview');
            
            preview.innerHTML = urls.filter(url => url.trim()).map((url, index) => `
                <img src="${url}" class="image-preview" alt="Preview ${index + 1}" 
                     onerror="this.src='https://images.unsplash.com/photo-1568605114967-8130f3a36994?w=400&auto=format'">
            `).join('');
        }

        function updateAmenitiesPreview() {
            const selected = Array.from(document.querySelectorAll('input[type="checkbox"]:checked'))
                .map(cb => cb.value);
            const preview = document.getElementById('amenitiesPreview');
            
            preview.innerHTML = selected.map(amenity => 
                `<span class="amenity-tag">${amenity}</span>`
            ).join('') || '<span class="text-muted">No amenities selected</span>';
        }

        function validateField(field) {
            if (field.value.trim() === '' && field.hasAttribute('required')) {
                field.style.borderColor = '#EF4444';
            } else {
                field.style.borderColor = '#10B981';
            }
        }

        function resetForm() {
            document.getElementById('farmhouseForm').reset();
            document.getElementById('photoPreview').innerHTML = '';
            document.getElementById('amenitiesPreview').innerHTML = '';
        }

        // ==================== DATE MANAGEMENT ====================
        function generateCalendar(farmhouseId) {
            const farmhouse = farmhouses.find(f => f.id === farmhouseId);
            if (!farmhouse) return;

            const calendarDiv = document.getElementById('availabilityCalendar');
            const today = new Date();
            const month = today.getMonth();
            const year = today.getFullYear();
            
            let html = '<div class="text-center mb-3"><h6>' + 
                       today.toLocaleString('default', { month: 'long', year: 'numeric' }) + 
                       '</h6></div><div class="row">';
            
            // Day headers
            const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            days.forEach(day => {
                html += `<div class="col p-2 text-center fw-bold">${day}</div>`;
            });
            
            html += '</div><div class="row">';
            
            // Get first day of month
            const firstDay = new Date(year, month, 1).getDay();
            
            // Add empty cells for days before first day
            for (let i = 0; i < firstDay; i++) {
                html += '<div class="col p-2"></div>';
            }
            
            // Add days
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            for (let day = 1; day <= daysInMonth; day++) {
                const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                const date = new Date(year, month, day);
                
                let className = 'calendar-day available-date';
                let onClick = `toggleDateSelection('${dateStr}')`;
                
                // Check if date is blocked
                if (farmhouse.blockedDates?.includes(dateStr)) {
                    className = 'calendar-day booked-date';
                    onClick = '';
                }
                
                // Check if date is in past
                if (date < today) {
                    className = 'calendar-day booked-date';
                    onClick = '';
                }
                
                html += `
                    <div class="col p-2">
                        <div class="${className}" ${onClick ? `onclick="${onClick}"` : ''}>
                            ${day}
                        </div>
                    </div>
                `;
                
                // Start new row after Saturday
                if ((firstDay + day) % 7 === 0 && day !== daysInMonth) {
                    html += '</div><div class="row">';
                }
            }
            
            html += '</div>';
            calendarDiv.innerHTML = html;
        }

        function toggleDateSelection(dateStr) {
            if (selectedDates.has(dateStr)) {
                selectedDates.delete(dateStr);
                document.querySelector(`[onclick*="${dateStr}"]`).classList.remove('selected-date');
            } else {
                selectedDates.add(dateStr);
                document.querySelector(`[onclick*="${dateStr}"]`).classList.add('selected-date');
            }
        }

        function blockSelectedDates() {
            const farmhouseId = document.getElementById('currentFarmhouseId').value;
            const farmhouse = farmhouses.find(f => f.id == farmhouseId);
            
            if (farmhouse && selectedDates.size > 0) {
                farmhouse.blockedDates = [...(farmhouse.blockedDates || []), ...Array.from(selectedDates)];
                localStorage.setItem('farmhouses', JSON.stringify(farmhouses));
                
                selectedDates.clear();
                generateCalendar(farmhouseId);
                updateBlockedDatesList(farmhouseId);
                showNotification('Dates Blocked', `${selectedDates.size} dates blocked`);
            }
        }

        function unblockSelectedDates() {
            const farmhouseId = document.getElementById('currentFarmhouseId').value;
            const farmhouse = farmhouses.find(f => f.id == farmhouseId);
            
            if (farmhouse && selectedDates.size > 0) {
                farmhouse.blockedDates = (farmhouse.blockedDates || []).filter(
                    date => !selectedDates.has(date)
                );
                localStorage.setItem('farmhouses', JSON.stringify(farmhouses));
                
                selectedDates.clear();
                generateCalendar(farmhouseId);
                updateBlockedDatesList(farmhouseId);
                showNotification('Dates Unblocked', `${selectedDates.size} dates unblocked`);
            }
        }

        function updateBlockedDatesList(farmhouseId) {
            const farmhouse = farmhouses.find(f => f.id == farmhouseId);
            const listDiv = document.getElementById('blockedDatesList');
            
            if (farmhouse?.blockedDates?.length > 0) {
                listDiv.innerHTML = `
                    <h6 class="mb-2">Blocked Dates</h6>
                    <div class="d-flex flex-wrap gap-2">
                        ${farmhouse.blockedDates.map(date => 
                            `<span class="badge bg-danger">${date}</span>`
                        ).join('')}
                    </div>
                `;
            } else {
                listDiv.innerHTML = '<p class="text-muted">No dates blocked</p>';
            }
        }

        // ==================== DATA MANAGEMENT ====================
        function loadSampleDataIfEmpty() {
            if (farmhouses.length === 0) {
                // Add sample farmhouses after 2 seconds
                setTimeout(() => {
                    if (confirm('Would you like to load sample farmhouse data?')) {
                        loadSampleData();
                    }
                }, 2000);
            }
        }

        function loadSampleData() {
            farmhouses = [
                {
                    id: 1,
                    name: "Riverside Farm Retreat",
                    location: "Blue Ridge Mountains, VA",
                    bedrooms: 3,
                    bathrooms: 2,
                    maxGuests: 6,
                    description: "Beautiful farmhouse overlooking the river with modern amenities.",
                    price: 189,
                    weekendPrice: 225,
                    availableFrom: new Date().toISOString().split('T')[0],
                    availableTo: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                    photoUrls: [
                        "https://images.unsplash.com/photo-1513584684374-8bab748fbf90?w=800&auto=format&fit=crop",
                        "https://images.unsplash.com/photo-1568605114967-8130f3a36994?w-800&auto=format&fit=crop"
                    ],
                    amenities: ["WiFi", "Kitchen", "Parking", "Garden", "Pet Friendly"],
                    createdAt: new Date().toISOString(),
                    lastUpdated: new Date().toISOString(),
                    status: "available",
                    blockedDates: []
                },
                {
                    id: 2,
                    name: "Sunset Valley Farm",
                    location: "Shenandoah Valley, WV",
                    bedrooms: 4,
                    bathrooms: 3,
                    maxGuests: 8,
                    description: "Luxury farmhouse with panoramic valley views and private pool.",
                    price: 275,
                    weekendPrice: 325,
                    availableFrom: new Date().toISOString().split('T')[0],
                    availableTo: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                    photoUrls: [
                        "https://images.unsplash.com/photo-1571896349842-33c89424de2d?w=800&auto=format&fit=crop"
                    ],
                    amenities: ["WiFi", "Pool", "Hot Tub", "Kitchen", "Parking", "AC"],
                    createdAt: new Date().toISOString(),
                    lastUpdated: new Date().toISOString(),
                    status: "available",
                    blockedDates: []
                }
            ];
            
            localStorage.setItem('farmhouses', JSON.stringify(farmhouses));
            updateAllCounters();
            renderFarmhouses();
            showNotification('Sample Data Loaded', '2 sample farmhouses added');
        }

        function exportData() {
            const data = {
                farmhouses: farmhouses,
                bookings: bookings,
                exportedAt: new Date().toISOString()
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `farmhouse-data-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            
            showNotification('Data Exported', 'All data downloaded as JSON');
        }

        function autoSaveDraft() {
            // Auto-save form data as draft
            const formData = {
                name: document.getElementById('name')?.value,
                location: document.getElementById('location')?.value,
                price: document.getElementById('price')?.value
            };
            
            if (formData.name || formData.location) {
                localStorage.setItem('formDraft', JSON.stringify(formData));
                console.log('Draft auto-saved');
            }
        }
    </script>
</body>
</html>
